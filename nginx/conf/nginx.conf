worker_processes 4;

events { worker_connections 1024; }

http {

  # Login #
  server {
    listen 80;
    server_name login.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client user-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
    }
    location /static {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client user-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
    }
  }

  # studio #

  server {
    listen 80;
    server_name studio.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client studio-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
    }

    location /creatives {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client studio-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
    }

    location /template_lib {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client studio-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
    }
  }

  server {
    listen 80;
    server_name studio.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client studio-client;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Set hostname to variable to lazyly resolve it and allow starting nginx
  # Backoffice #
  server {
    listen 80;
    server_name admin.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client backoffice-client;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Publisher panel #
  server {
    listen 80;
    server_name publishers.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client publisher-panel-client;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }


  # Gohan - Client #
  server {
    listen 80;
    server_name client.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client gohan-client;
      proxy_pass http://$upstream_client:8886;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
    }
  }

  # Tag-manager #
  server {
    listen 80;
    server_name tms.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client tag-manager-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }

    location /api {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client tag-manager-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
    location /explorer {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client tag-manager-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Sherlock #
  server {
    listen 80;
    server_name sherlock.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client sherlock-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Tagging #
  server {
    listen 80;
    server_name tagging.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client tagging-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Events Big data #
  server {
    listen 80;
    server_name e2.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client event-bigdata-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Analytics #
  server {
    listen 80;
    server_name analytics.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client analytics-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_buffering off;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Error #
  server {
    listen 80;
    server_name errors.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client error-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }

  }

  # Campaign #
  server {
    listen 80;
    server_name campaigns.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client campaign-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }

  }

  # Custom Categories #
  server {
    listen 80;
    server_name custom-categories.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client custom-categories-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }

  }

  # Blacklist
  server {
    listen 80;
    server_name blacklist.api.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client blacklist-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  # Creative preview
  server {
    listen 80;
    server_name preview.seedtag.local;

    location / {
      resolver 127.0.0.11 valid=30s;
      set $upstream_client creative-preview-service;
      proxy_pass http://$upstream_client:3000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      include cors_settings.conf;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
      listen 80 default_server;
  }
}

daemon off;
